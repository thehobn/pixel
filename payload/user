#!/bin/bash

echo "$(tput setaf 6 & tput smso)Applying tsowell patch . . .$(tput sgr0)"
mkdir -v ~/.builds
cd ~/.builds && curl -LO https://github.com/tsowell/linux-samus/releases/download/v0.2.2/linux-samus-arch-0.2.2.tar
tar xvf linux-samus-arch-0.2.2.tar
cd ~/.builds/linux-samus-arch-0.2.2 && sudo pacman -U *.pkg.tar.xz --noconfirm
sudo cp -v -r ~/.builds/linux-samus-arch-0.2.2/ucm/bdw-rt5677 /usr/share/alsa/ucm
sudo chown -R root:root /usr/share/alsa/ucm/bdw-rt5677
sudo mkdir /etc/acpi
sudo mv -v /handler.sh /etc/acpi/handler.sh
sudo chown root:root /etc/acpi/handler.sh

echo "$(tput setaf 6 & tput smso)Installing yaourt . . .$(tput sgr0)"
cd ~/.builds && wget https://aur.archlinux.org/packages/pa/package-query/package-query.tar.gz && tar -xzf package-query.tar.gz
cd ~/.builds && wget https://aur.archlinux.org/packages/ya/yaourt/yaourt.tar.gz && tar -xzf yaourt.tar.gz
cd ~/.builds/package-query && makepkg -si --noconfirm
cd ~/.builds/yaourt && makepkg -si --noconfirm
sudo sed -i 's/#AURURL/AURURL/' /etc/yaourtrc
sudo sed -i 's/aur/aur4/' /etc/yaourtrc

echo "$(tput setaf 6 & tput smso)Installing AUR packages . . .$(tput sgr0)"
yaourt -Syua st-git-zsh --noconfirm

echo "$(tput setaf 6 & tput smso)Installing DWM . . .$(tput sgr0)"
cd ~/.builds && sudo abs community/dwm
cp -v -r /var/abs/community/dwm ~/.builds/dwm
sudo chown min:users ~/config.h
cd ~/.builds/dwm && makepkg -si --noconfirm
mv -v ~/config.h ~/.builds/dwm/config.h
cp -v ~/.builds/dwm/config.h ~/.builds/dwm/src/config.h
cd ~/.builds/dwm && makepkg -efi --skipinteg --noconfirm

echo "$(tput setaf 6 & tput smso)Installing drive . . .$(tput sgr0)"
export GOPATH=~/.builds/gopath && go get -u github.com/odeke-em/drive/cmd/drive
sudo cp ~/.builds/gopath/bin/drive /usr/bin

echo "$(tput setaf 6 & tput smso)Editing xinitrc . . .$(tput sgr0)"
sudo mv -v /.xinitrc ~/.xinitrc
sudo chown min:users ~/.xinitrc

echo "$(tput setaf 6 & tput smso)Setting up X autostart . . .$(tput sgr0)"
sudo mv -v /.zlogin ~/.zlogin
sudo chown min:users ~/.zlogin
touch ~/.hushlogin

echo "$(tput setaf 6 & tput smso)Finishing up . .$(tput sgr0)"
sudo mv -v /finish ~/finish
sudo chown min:users ~/finish
sudo rm /user
