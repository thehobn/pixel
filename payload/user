#!/bin/bash
SSD=/dev/disk/by-id/ata-KINGSTON_RBU-SUS151S364GD_50026B7E51D74E12
SD=/dev/disk/by-id/usb-Generic_Power_Saving_USB_000000000260-0:0

echo "$(tput setaf 6 & tput smso)Installing cower and pacaur . . .$(tput sgr0)"
cd ~/.builds && git clone https://aur.archlinux.org/cower.git && cd cower && makepkg -si --skipinteg --noconfirm
cd ~/.builds && git clone https://aur.archlinux.org/pacaur.git && cd pacaur && makepkg -si --noconfirm

echo "$(tput setaf 6 & tput smso)Installing 4.1 samus kernel . . .$(tput sgr0)"
cd ~/.builds && git clone https://github.com/raphael/linux-4.1-samus
cd ~/.builds/linux-4.1-samus/aur && makepkg -si --noconfirm
sudo grub-mkconfig -o /boot/grub/grub.cfg
sudo grub-install --target=i386-pc --recheck --debug $SD

echo "$(tput setaf 6 & tput smso)Installing dwm and st. . .$(tput sgr0)"
cd ~/.builds/dwm && makepkg -si --skipinteg --noconfirm
cd ~/.builds/st && makepkg -si --noconfirm

echo "$(tput setaf 6 & tput smso)Setting backup encryption password for /boot . . .$(tput sgr0)"
sudo cryptsetup luksAddKey $SD-part2 --key-file=/etc/tmp
sudo cryptsetup luksRemoveKey $SD-part2 --key-file=/etc/tmp --batch-mode
sudo shred -v /etc/tmp -n 8 -z

echo "$(tput setaf 6 & tput smso)Setting backup encryption password for / . . .$(tput sgr0)"
sudo cryptsetup luksAddKey $SSD --key-file=/boot/key

echo "$(tput setaf 6 & tput smso)Setting root password . . .$(tput sgr0)"
sudo passwd root

echo "$(tput setaf 6 & tput smso)Setting user password. . .$(tput sgr0)"
sudo passwd min

echo "$(tput setaf 6 & tput smso)Cleaning up . . .$(tput sgr0)"
sudo rm /user
