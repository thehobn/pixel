SSD=/dev/disk/by-id/ata-KINGSTON_RBU-SUS151S364GD_50026B7E51D74E12
SD=/dev/disk/by-id/usb-Generic_Power_Saving_USB_000000000260-0:0

reflector -l 100 --sort rate --save /etc/pacman.d/mirrorlist 
pacman -R linux --noconfirm
pacman -Sy

echo en_US.UTF-8 UTF-8 >> /etc/locale.gen
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf
export LANG=en_US.UTF-8
ln -s /usr/share/zoneinfo/US/Pacific /etc/localtime
hwclock --systohc --utc

echo pixel > /etc/hostname
useradd -g users -G wheel min

systemctl enable connman.service

chsh -s /usr/bin/zsh root
chsh -s /usr/bin/zsh min

su min -c cd ~/.builds && git clone https://aur.archlinux.org/cower.git && cd cower && makepkg -si --skipinteg --noconfirm
su min -c cd ~/.builds && git clone https://aur.archlinux.org/pacaur.git && cd pacaur && makepkg -si --noconfirm

pacaur -Sa physlock --noconfirm --noedit

su min -c cd ~/.builds && git clone https://github.com/raphael/linux-4.1-samus
su min -c cd ~/.builds/linux-4.1-samus/aur && makepkg -si --noconfirm
grub-mkconfig -o /boot/grub/grub.cfg
grub-install --target=i386-pc --recheck $SD

su min -c cd ~/.builds/dwm && makepkg -si --noconfirm
su min -c cd ~/.builds/st && makepkg -si --noconfirm

echo Setting boot password
cryptsetup luksAddKey $SD-part2 --key-file=/etc/tmp
cryptsetup luksRemoveKey $SD-part2 --key-file=/etc/tmp --batch-mode
shred /etc/tmp -n 10 -z

echo Setting root password
passwd root

echo Setting user password
passwd min

chown -R min:users /home/min
rm chroot
